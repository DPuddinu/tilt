---
import { ITEMS_PER_PAGE, getPaginatedGoals } from '@/api/goals/queries';
import type { GoalFilters } from '@/types/filters.types';
import GoalsList from '@components/GoalsList.astro';
import type { TActivity } from 'db/config';

type Props = {
  goalFilters: GoalFilters;
  currentPage: number;
  offset: number;
  params: Record<string, string | null> | undefined;
  activities: TActivity[];
};
const { goalFilters, currentPage, params, offset = 0, activities } = Astro.props;
const { user } = Astro.locals;
const { countGoals, goals } = await getPaginatedGoals({
  userId: user.id,
  page: currentPage,
  filters: goalFilters
});
const totalPages = Math.ceil(countGoals / ITEMS_PER_PAGE);
---
<GoalsList
  queryParams={params}
  activities={activities}
  goals={goals}
  totalPages={totalPages}
  offset={offset}
  currentPage={currentPage}
  itemsPerPage={ITEMS_PER_PAGE}
/>
